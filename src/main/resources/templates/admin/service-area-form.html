<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments :: head(${isEdit ? 'Edit Service Area' : 'Create Service Area'})}"></head>
<body>
<style>
    .content-area {
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px;
    }

    .form-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 25px;
    }

    .form-card {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 0.95rem;
        transition: border-color 0.3s;
    }

    .form-control:focus {
        border-color: #667eea;
        outline: none;
    }

    .error-message {
        color: #ef4444;
        font-size: 0.85rem;
        display: none;
    }

    .error-message.show {
        display: block;
    }

    .form-control.error {
        border-color: #ef4444;
    }

    .info-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        height: fit-content;
    }

    .tip-box {
        background: #e0e7ff;
        border-left: 4px solid #667eea;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
    }

    @media (max-width: 968px) {
        .form-container {
            grid-template-columns: 1fr;
        }

        .info-card {
            order: -1;
        }
    }
</style>

<aside th:replace="~{admin/fragments :: sidebar('areas')}"></aside>

<main class="main-content" id="mainContent">
    <header class="top-header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <a href="/admin/areas" class="btn-secondary"
               style="padding: 8px 15px; border-radius: 8px; text-decoration:none;">‚Üê Back</a>
            <div class="header-title" style="margin-left:15px;">
                <h1 th:text="${isEdit ? 'Edit Service Area' : 'Create Service Area'}">Form</h1>
            </div>
        </div>
    </header>

    <div class="content-area">
        <form th:action="${isEdit ? '/admin/areas/edit/' + serviceArea.id : '/admin/areas/create'}"
              method="post" id="serviceAreaForm" onsubmit="return validateForm()">

            <div class="form-container">
                <div class="form-card">
                    <h2><span>üó∫Ô∏è</span> <span>Service Area Information</span></h2>

                    <div class="form-group">
                        <label for="name">Area Name <span style="color:red">*</span></label>
                        <input type="text" class="form-control" id="name" name="name" th:value="${serviceArea.name}"
                               placeholder="e.g. Downtown Lagos" required oninput="clearError('name'); saveDraft()">
                        <div class="error-message" id="nameError">Name is required</div>
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description" name="description"
                                  th:text="${serviceArea.description}" placeholder="Description..."
                                  style="min-height:120px;" oninput="saveDraft()"></textarea>
                    </div>

                    <div class="form-actions" style="display:flex; gap:10px; margin-top:30px;">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <span th:text="${isEdit ? 'üíæ Update Area' : '‚ûï Create Area'}">Save</span>
                        </button>
                        <a href="/admin/areas" class="btn btn-secondary">Cancel</a>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìã Quick Info</h3>
                    <div class="tip-box">
                        <h4>üí° Tips</h4>
                        <ul>
                            <li>Use clear names</li>
                            <li>Include landmarks in description</li>
                            <li th:if="${isEdit}">Cannot delete active areas</li>
                            <li>Ctrl+S to save</li>
                        </ul>
                    </div>
                </div>
            </div>
        </form>
    </div>
</main>

<div th:replace="~{admin/fragments :: commonScripts}"></div>
<script th:inline="javascript">
    const isEdit = /*[[${isEdit}]]*/ false;

    function clearError(id) {
        document.getElementById(id).classList.remove('error');
        document.getElementById(id + 'Error').classList.remove('show');
    }

    function validateForm() {
        const name = document.getElementById('name');
        if (!name.value.trim()) {
            name.classList.add('error');
            document.getElementById('nameError').classList.add('show');
            return false;
        }
        // Clear draft on successful submit
        localStorage.removeItem('serviceAreaDraft');
        return true;
    }

    // --- Draft Logic ---
    function saveDraft() {
        if (isEdit) return; // Don't save drafts in edit mode to avoid overwriting legitimate data
        const data = {
            name: document.getElementById('name').value,
            description: document.getElementById('description').value,
            timestamp: new Date().getTime()
        };
        localStorage.setItem('serviceAreaDraft', JSON.stringify(data));
    }

    // Load Draft on startup
    document.addEventListener('DOMContentLoaded', function () {
        if (!isEdit) {
            const draft = localStorage.getItem('serviceAreaDraft');
            if (draft) {
                const draftData = JSON.parse(draft);
                // Simple check: if draft is older than 24h, discard
                const now = new Date().getTime();
                if (now - draftData.timestamp < 24 * 60 * 60 * 1000) {
                    if (confirm('You have an unsaved draft from ' + new Date(draftData.timestamp).toLocaleString() + '. Restore it?')) {
                        document.getElementById('name').value = draftData.name;
                        document.getElementById('description').value = draftData.description;
                    } else {
                        localStorage.removeItem('serviceAreaDraft');
                    }
                }
            }
        }
    });

    // Keyboard Shortcuts
    document.addEventListener('keydown', function (e) {
        // Ctrl+S to save
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            if (validateForm()) {
                document.getElementById('serviceAreaForm').submit();
            }
        }
    });
</script>
</body>
</html>