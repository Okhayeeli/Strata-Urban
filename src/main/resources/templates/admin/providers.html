<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments :: head('Providers')}"></head>
<body>

<aside th:replace="~{admin/fragments :: sidebar('providers')}"></aside>

<main class="main-content" id="mainContent">
    <header th:replace="~{admin/fragments :: topHeader('Providers Management')}"></header>

    <div class="page-content">
        <div class="stats-row">
            <div class="stat-box">
                <h4>Total Providers</h4>
                <p th:text="${totalProviders} ?: '0'">0</p>
            </div>
            <div class="stat-box">
                <h4>Active Providers</h4>
                <p th:text="${activeProviders} ?: '0'">0</p>
            </div>
            <div class="stat-box">
                <h4>Total Vehicles</h4>
                <p th:text="${totalVehicles} ?: '0'">0</p>
            </div>
            <div class="stat-box">
                <h4>Avg Rating</h4>
                <p th:text="${averageRating} ?: '0.0'">0.0</p>
            </div>
        </div>

        <div class="filters-section">
            <form th:action="@{/admin/providers}" method="get">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Search Name</label>
                        <input type="text" name="name" th:value="${param.name}" placeholder="Provider name...">
                    </div>
                    <div class="filter-group">
                        <label>Service Type</label>
                        <select name="serviceType">
                            <option value="">All Types</option>
                            <option value="TRANSPORT" th:selected="${param.serviceType == 'TRANSPORT'}">Transport</option>
                            <option value="LOGISTICS" th:selected="${param.serviceType == 'LOGISTICS'}">Logistics</option>
                            <option value="DELIVERY" th:selected="${param.serviceType == 'DELIVERY'}">Delivery</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <a href="/admin/providers" class="btn btn-secondary">Clear</a>
                </div>
            </form>
        </div>

        <div class="providers-table">
            <div class="table-header">
                <h3>All Providers (<span th:text="${providers.totalElements}">0</span>)</h3>
            </div>

            <table>
                <thead>
                <tr>
                    <th>Provider</th>
                    <th>Company</th>
                    <th>Service Type</th>
                    <th>Location</th>
                    <th>Rating</th>
                    <th>Vehicles</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="provider : ${providers.content}">
                    <td>
                        <div class="provider-info">
                            <div class="provider-logo">
                                <span th:text="${#strings.substring(provider.companyName ?: 'P', 0, 1)}">P</span>
                            </div>
                            <div class="provider-details">
                                <h4 th:text="${provider.firstName + ' ' + provider.lastName}">Name</h4>
                                <p th:text="${provider.email}">email</p>
                            </div>
                        </div>
                    </td>
                    <td th:text="${provider.companyName}">Company</td>
                    <td>
                        <span th:if="${provider.serviceTypes != null && !provider.serviceTypes.isEmpty()}" th:text="${provider.serviceTypes[0]}">Type</span>
                        <span th:if="${provider.serviceTypes == null || provider.serviceTypes.isEmpty()}">N/A</span>
                    </td>
                    <td th:text="${provider.city + ', ' + provider.state}">Location</td>
                    <td>‚≠ê <span th:text="${provider.rating != null ? #numbers.formatDecimal(provider.rating, 1, 1) : '0.0'}">0.0</span></td>
                    <td th:text="${provider.transportCount} ?: '0'">0</td>
                    <td>
                        <span class="badge badge-success" th:if="${provider.emailVerified}">Active</span>
                        <span class="badge badge-warning" th:unless="${provider.emailVerified}">Pending</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" th:onclick="'viewProvider(' + ${provider.id} + ')'">üëÅÔ∏è</button>
                            <button class="btn-icon btn-edit" th:onclick="'editProvider(' + ${provider.id} + ')'">‚úèÔ∏è</button>
                            <button class="btn-icon btn-delete" th:onclick="'deleteProvider(' + ${provider.id} + ')'">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="pagination" th:if="${providers.totalPages > 1}">
                <button th:disabled="${providers.first}"
                        th:onclick="'window.location.href=\'/admin/providers?page=' + ${providers.number - 1} + '&size=' + ${providers.size} + '\''">
                    Previous
                </button>
                <button th:each="i : ${#numbers.sequence(0, providers.totalPages - 1)}"
                        th:text="${i + 1}"
                        th:classappend="${i == providers.number} ? 'current-page' : ''"
                        th:onclick="'window.location.href=\'/admin/providers?page=' + ${i} + '&size=' + ${providers.size} + '\''">
                </button>
                <button th:disabled="${providers.last}"
                        th:onclick="'window.location.href=\'/admin/providers?page=' + ${providers.number + 1} + '&size=' + ${providers.size} + '\''">
                    Next
                </button>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{admin/fragments :: commonScripts}"></div>

<script>
    function viewProvider(id) { window.location.href = '/admin/providers/' + id; }
    function editProvider(id) { window.location.href = '/admin/providers/' + id + '/edit'; }
    function deleteProvider(id) {
        if (confirm('Are you sure you want to delete this provider?')) {
            fetch('/admin/providers/' + id + '/delete', { method: 'POST', headers: { 'Content-Type': 'application/json' } })
                .then(response => {
                    if (response.ok) { alert('Provider deleted'); window.location.reload(); }
                    else { alert('Failed to delete provider'); }
                });
        }
    }
</script>
</body>
</html>