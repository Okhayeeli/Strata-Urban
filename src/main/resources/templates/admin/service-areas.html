<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments :: head('Service Areas')}"></head>
<body>
<style>
    /* Page Specific CSS */
    .alert {
        animation: slideDown 0.3s ease;
        border-left-width: 4px;
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .alert-success {
        background: #d1fae5;
        color: #065f46;
        border-color: #10b981;
    }

    .alert-error {
        background: #fee2e2;
        color: #991b1b;
        border-color: #ef4444;
    }

    .action-bar {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .search-filter-group {
        display: flex;
        gap: 15px;
        flex: 1;
        min-width: 300px;
    }

    .search-box {
        flex: 1;
        max-width: 400px;
        position: relative;
    }

    .search-box input {
        width: 100%;
        padding: 12px 15px 12px 45px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
    }

    .search-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
    }

    .stat-icon.blue {
        background: rgba(102, 126, 234, 0.1);
    }

    .stat-icon.green {
        background: rgba(16, 185, 129, 0.1);
    }

    .stat-icon.orange {
        background: rgba(251, 146, 60, 0.1);
    }

    /* Table specific */
    .table-section {
        background: white;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }

    .bulk-actions {
        display: none;
        align-items: center;
        gap: 12px;
    }

    .bulk-actions.active {
        display: flex;
    }

    .provider-count {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: #f3f4f6;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .provider-count.has-providers {
        background: #d1fae5;
        color: #065f46;
    }

    .provider-count.no-providers {
        background: #fee2e2;
        color: #991b1b;
    }

    .action-btns {
        display: flex;
        gap: 8px;
    }

    .action-btn {
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.85rem;
        text-decoration: none;
        display: inline-block;
    }

    .btn-view {
        background: #e0e7ff;
        color: #4f46e5;
    }

    .btn-edit {
        background: #dbeafe;
        color: #1e40af;
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 15px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
    }
</style>

<aside th:replace="~{admin/fragments :: sidebar('areas')}"></aside>

<main class="main-content" id="mainContent">
    <header th:replace="~{admin/fragments :: topHeader('Service Areas')}"></header>

    <div class="content-area">
        <div th:if="${success}" class="alert alert-success">
            <span>‚úì</span> <span th:text="${success}">Success</span>
            <span class="alert-close" onclick="this.parentElement.remove()"
                  style="margin-left:auto;cursor:pointer">√ó</span>
        </div>
        <div th:if="${error}" class="alert alert-error">
            <span>‚ö†</span> <span th:text="${error}">Error</span>
            <span class="alert-close" onclick="this.parentElement.remove()"
                  style="margin-left:auto;cursor:pointer">√ó</span>
        </div>

        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-info">
                    <h3>Total Areas</h3>
                    <p th:text="${totalAreas ?: 0}">0</p>
                </div>
                <div class="stat-icon blue">üó∫Ô∏è</div>
            </div>
            <div class="stat-card">
                <div class="stat-info"><h3>With Providers</h3>
                    <p id="areasWithProviders">-</p></div>
                <div class="stat-icon green">‚úì</div>
            </div>
        </div>

        <div class="action-bar">
            <div class="search-filter-group">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="Search..." th:value="${search}"
                           onkeyup="handleSearch(event)">
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-danger" id="bulkDeleteBtn" onclick="bulkDeleteAreas()" disabled>
                    <span>üóëÔ∏è</span> Delete Selected
                </button>
                <a href="/admin/areas/create" class="btn btn-primary"><span>+</span> Add Service Area</a>
            </div>
        </div>

        <div class="table-section">
            <div class="table-header">
                <h2>Service Areas List</h2>
                <div class="bulk-actions" id="bulkActions">
                    <span class="selected-count" id="selectedCount">0 selected</span>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                    <tr>
                        <th class="checkbox-cell"><input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                        </th>
                        <th class="sortable" onclick="sortTable('name')">Area Name ‚áÖ</th>
                        <th>Description</th>
                        <th class="sortable" onclick="sortTable('providers')">Providers ‚áÖ</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="area : ${serviceAreas}" th:data-id="${area.id}">
                        <td class="checkbox-cell"><input type="checkbox" class="row-checkbox" th:value="${area.id}"
                                                         onchange="updateBulkActions()"></td>
                        <td>
                            <div class="area-name" th:text="${area.name}">Name</div>
                        </td>
                        <td>
                            <div class="area-description" th:text="${area.description ?: 'No description'}">Desc</div>
                        </td>
                        <td>
                            <span th:with="count=${providerCounts.get(area.id) ?: 0}"
                                  th:class="${count > 0 ? 'provider-count has-providers' : 'provider-count no-providers'}">
                                <span>üè¢</span> <span th:text="${count}">0</span>
                            </span>
                        </td>
                        <td>
                            <div class="action-btns">
                                <a th:href="@{/admin/areas/view/{id}(id=${area.id})}" class="action-btn btn-view">üëÅÔ∏è
                                    View</a>
                                <a th:href="@{/admin/areas/edit/{id}(id=${area.id})}" class="action-btn btn-edit">‚úèÔ∏è
                                    Edit</a>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<div class="modal" id="deleteModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Confirm Deletion</h3>
            <span class="modal-close" onclick="closeDeleteModal()">√ó</span>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete <strong id="deleteAreaName"></strong>?</p>
            <p style="color: #ef4444;">‚ö†Ô∏è This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <button class="btn btn-danger" id="confirmDeleteBtn" onclick="confirmDelete()">Delete Area</button>
        </div>
    </div>
</div>

<div th:replace="~{admin/fragments :: commonScripts}"></div>
<script>
    // ... [KEEP YOUR EXISTING JAVASCRIPT FROM ORIGINAL FILE HERE] ...
    // loadStatistics, handleSearch, sortTable, toggleSelectAll, updateBulkActions, etc.
</script>
</body>
</html>