<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments :: head('Service Area Details')}"></head>
<body>
<style>
    .back-btn {
        padding: 10px 15px;
        background: #f3f4f6;
        border-radius: 8px;
        text-decoration: none;
        color: #333;
        transition: background 0.3s;
    }

    .back-btn:hover {
        background: #e5e7eb;
    }

    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 40px;
        border-radius: 20px;
        color: white;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: 'üó∫Ô∏è';
        position: absolute;
        font-size: 15rem;
        opacity: 0.1;
        right: -50px;
        bottom: -50px;
    }

    .hero-content {
        position: relative;
        z-index: 1;
    }

    .hero-content h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .hero-content p {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 25px;
    }

    .hero-stats {
        display: flex;
        gap: 30px;
        flex-wrap: wrap;
    }

    .hero-stat {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .hero-stat-icon {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 25px;
        margin-bottom: 30px;
    }

    .card {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 15px;
    }

    .info-item {
        display: flex;
        justify-content: space-between;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 10px;
    }

    .info-label {
        font-weight: 600;
        color: #666;
    }

    .providers-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
    }

    .providers-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    .provider-card {
        padding: 20px;
        background: #f8f9fa;
        border-radius: 12px;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .provider-card:hover {
        border-color: #667eea;
        background: white;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
    }

    .provider-avatar {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        float: left;
        margin-right: 15px;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
    }

    @media (max-width: 1024px) {
        .content-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<aside th:replace="~{admin/fragments :: sidebar('areas')}"></aside>

<main class="main-content" id="mainContent">
    <header class="top-header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <a href="/admin/areas" class="back-btn">‚Üê Back to Areas</a>
            <div class="header-title" style="margin-left: 15px;">
                <h1>Service Area Details</h1>
            </div>
        </div>
        <div class="header-actions">
            <a th:href="@{/admin/areas/{id}/assign-providers(id=${serviceArea.id})}" class="btn btn-primary">‚ûï Assign
                Providers</a>
            <a th:href="@{/admin/areas/edit/{id}(id=${serviceArea.id})}" class="btn btn-primary">‚úèÔ∏è Edit Area</a>
            <button class="btn btn-delete" onclick="showDeleteModal()">üóëÔ∏è Delete</button>
        </div>
    </header>

    <div class="content-area">
        <div class="hero-section">
            <div class="hero-content">
                <h1 th:text="${serviceArea.name}">Area Name</h1>
                <p th:text="${serviceArea.description ?: 'No description'}">Description</p>
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-icon">üè¢</div>
                        <div class="hero-stat-info"><h3>Active Providers</h3>
                            <p th:text="${providerCount}">0</p></div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-icon">‚úì</div>
                        <div class="hero-stat-info"><h3>Status</h3>
                            <p th:text="${providerCount > 0 ? 'Active' : 'Inactive'}">Active</p></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-grid">
            <div class="card">
                <div class="card-header"><h2>üìã Area Information</h2></div>
                <div class="info-grid">
                    <div class="info-item"><span class="info-label">Area ID</span><span
                            th:text="${serviceArea.id}">-</span></div>
                    <div class="info-item"><span class="info-label">Name</span><span
                            th:text="${serviceArea.name}">-</span></div>
                    <div class="info-item"><span class="info-label">Coverage Status</span>
                        <span th:if="${providerCount > 0}" style="color: #10b981;">‚úì Covered</span>
                        <span th:unless="${providerCount > 0}" style="color: #ef4444;">‚ö† No Coverage</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h2>‚ö° Actions</h2></div>
                <div class="info-grid">
                    <a th:href="@{/admin/areas/edit/{id}(id=${serviceArea.id})}" class="info-item"
                       style="text-decoration:none; color:inherit; cursor:pointer;">
                        <span class="info-label">‚úèÔ∏è Edit Details</span><span>‚Üí</span>
                    </a>
                    <div class="info-item" style="cursor: pointer;" onclick="exportAreaData()">
                        <span class="info-label">üìÑ Export Data</span><span>‚Üí</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="providers-section">
            <div class="card-header"><h2>üè¢ Providers in this Area</h2></div>
            <div th:if="${providers == null or providers.empty}"
                 style="text-align: center; color: #999; padding: 20px;">
                <p>No providers assigned yet.</p>
                <a th:href="@{/admin/areas/{id}/assign-providers(id=${serviceArea.id})}" class="btn btn-primary">Assign
                    Providers</a>
            </div>
            <div th:unless="${providers == null or providers.empty}" class="providers-grid">
                <div th:each="provider : ${providers}" class="provider-card">
                    <div class="provider-avatar"><span
                            th:text="${#strings.substring(provider.companyName, 0, 1)}">P</span></div>
                    <h3 th:text="${provider.companyName}">Name</h3>
                    <p style="font-size:0.9rem; color:#666;" th:text="${provider.email}">email</p>
                    <a th:href="@{/admin/providers/view/{id}(id=${provider.id})}"
                       style="font-size:0.85rem; color:#667eea; text-decoration:none; display:block; margin-top:10px;">View
                        Details ‚Üí</a>
                </div>
            </div>
        </div>
    </div>
</main>

<div class="modal" id="deleteModal">
    <div class="modal-content">
        <h3>Confirm Deletion</h3>
        <p>Are you sure you want to delete <strong th:text="${serviceArea.name}"></strong>?</p>
        <p th:if="${providerCount > 0}" style="color: #ef4444;">‚ö†Ô∏è Cannot delete area with active providers.</p>
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <button class="btn btn-delete" th:disabled="${providerCount > 0}" onclick="confirmDelete()">Delete</button>
        </div>
    </div>
</div>

<div th:replace="~{admin/fragments :: commonScripts}"></div>
<script th:inline="javascript">
    const serviceAreaId = /*[[${serviceArea.id}]]*/ 0;

    function showDeleteModal() {
        document.getElementById('deleteModal').classList.add('active');
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
    }

    function confirmDelete() {
        if (confirm('Final Confirmation: Delete this Service Area?')) {
            fetch('/admin/areas/delete/' + serviceAreaId, {method: 'POST'})
                .then(res => {
                    if (res.ok) window.location.href = '/admin/areas';
                    else alert('Deletion failed.');
                });
        }
    }

    function exportAreaData() {
        alert('Data export started. You will receive a notification when it is ready.');
        // fetch('/admin/areas/' + serviceAreaId + '/export')...
    }

    // Keyboard Shortcuts
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeDeleteModal();
        }
        if (e.key === 'Delete' && !e.ctrlKey) {
            // Only if no input is focused
            if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                showDeleteModal();
            }
        }
    });
</script>
</body>
</html>