<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{admin/fragments :: head('Clients')}"></head>
<body>

<aside th:replace="~{admin/fragments :: sidebar('clients')}"></aside>

<main class="main-content" id="mainContent">
    <header th:replace="~{admin/fragments :: topHeader('Clients Management')}"></header>

    <div class="page-content">
        <div class="stats-row">
            <div class="stat-box">
                <h4>Total Clients</h4>
                <p th:text="${totalClients} ?: '0'">0</p>
            </div>
            <div class="stat-box">
                <h4>Verified Clients</h4>
                <p th:text="${verifiedClients} ?: '0'">0</p>
            </div>
            <div class="stat-box">
                <h4>Active This Month</h4>
                <p th:text="${activeClients} ?: '0'">0</p>
            </div>
            <div class="stat-box">
                <h4>New This Week</h4>
                <p th:text="${newClients} ?: '0'">0</p>
            </div>
        </div>

        <div class="filters-section">
            <form th:action="@{/admin/clients}" method="get">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Search Name/Email</label>
                        <input type="text" name="search" th:value="${param.search}" placeholder="Search...">
                    </div>
                    <div class="filter-group">
                        <label>Verification Status</label>
                        <select name="verified">
                            <option value="">All Status</option>
                            <option value="true" th:selected="${param.verified == 'true'}">Verified</option>
                            <option value="false" th:selected="${param.verified == 'false'}">Unverified</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <a href="/admin/clients" class="btn btn-secondary">Clear</a>
                </div>
            </form>
        </div>

        <div class="clients-table">
            <div class="table-header">
                <h3>All Clients (<span th:text="${clients.totalElements}">0</span>)</h3>
            </div>

            <table>
                <thead>
                <tr>
                    <th>Client</th>
                    <th>Contact</th>
                    <th>Location</th>
                    <th>Joined</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="client : ${clients.content}">
                    <td>
                        <div class="client-info">
                            <div class="client-avatar">
                                <span th:text="${#strings.substring(client.firstName ?: 'C', 0, 1)}">C</span>
                            </div>
                            <div class="client-details">
                                <h4 th:text="${client.firstName + ' ' + client.lastName}">Name</h4>
                                <p th:text="'ID: ' + ${client.id}">ID</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="client-details">
                            <h4 th:text="${client.email}">email</h4>
                            <p th:text="${client.phone ?: 'No phone'}">Phone</p>
                        </div>
                    </td>
                    <td>
                        <span th:if="${client.city != null && client.state != null}" th:text="${client.city + ', ' + client.state}">Location</span>
                        <span th:if="${client.city == null || client.state == null}">N/A</span>
                    </td>
                    <td th:text="${client.lastPasswordChange != null ? #temporals.format(client.lastPasswordChange, 'MMM dd, yyyy') : 'N/A'}">Date</td>
                    <td>
                        <span class="badge badge-verified" th:if="${client.emailVerified}">‚úì Verified</span>
                        <span class="badge badge-unverified" th:unless="${client.emailVerified}">‚ö† Unverified</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" th:onclick="'viewClient(' + ${client.id} + ')'">üëÅÔ∏è</button>
                            <button class="btn-icon btn-edit" th:onclick="'editClient(' + ${client.id} + ')'">‚úèÔ∏è</button>
                            <button class="btn-icon btn-delete" th:onclick="'deleteClient(' + ${client.id} + ')'">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="pagination" th:if="${clients.totalPages > 1}">
                <button th:disabled="${clients.first}"
                        th:onclick="'window.location.href=\'/admin/clients?page=' + ${clients.number - 1} + '&size=' + ${clients.size} + '\''">
                    Previous
                </button>
                <button th:each="i : ${#numbers.sequence(0, clients.totalPages - 1)}"
                        th:text="${i + 1}"
                        th:classappend="${i == clients.number} ? 'current-page' : ''"
                        th:onclick="'window.location.href=\'/admin/clients?page=' + ${i} + '&size=' + ${clients.size} + '\''">
                </button>
                <button th:disabled="${clients.last}"
                        th:onclick="'window.location.href=\'/admin/clients?page=' + ${clients.number + 1} + '&size=' + ${clients.size} + '\''">
                    Next
                </button>
            </div>
        </div>
    </div>
</main>

<div th:replace="~{admin/fragments :: commonScripts}"></div>

<script>
    function viewClient(id) { window.location.href = '/admin/clients/' + id; }
    function editClient(id) { window.location.href = '/admin/clients/' + id + '/edit'; }
    function deleteClient(id) {
        if (confirm('Are you sure you want to delete this client?')) {
            fetch('/admin/clients/' + id + '/delete', { method: 'POST', headers: { 'Content-Type': 'application/json' } })
                .then(response => {
                    if (response.ok) { alert('Client deleted'); window.location.reload(); }
                    else { alert('Failed to delete client'); }
                });
        }
    }
</script>
</body>
</html>